require "integrations/requests/workflow/spec_helper"
describe "dna_rna_manual_extraction" do
  include_context "use core context service"
  include_context 'setup_s2_environment_for_dna_rna_manual_extraction'
  it "dna_rna_manual_extraction" do
    push_uuids(["5369ced0-744b-0130-e1b7-282066132de2", "5370a9c0-744b-0130-e1b7-282066132de2", "537663e0-744b-0130-e1b7-282066132de2", "537c3440-744b-0130-e1b7-282066132de2", "53ef5d80-744b-0130-e1b7-282066132de2", "541de560-744b-0130-e1b7-282066132de2", "549064e0-744b-0130-e1b7-282066132de2", "54f98010-744b-0130-e1b7-282066132de2", "550d9e20-744b-0130-e1b7-282066132de2", "5527ead0-744b-0130-e1b7-282066132de2", "553cd700-744b-0130-e1b7-282066132de2", "55543cd0-744b-0130-e1b7-282066132de2", "5568eb70-744b-0130-e1b7-282066132de2", "5584a020-744b-0130-e1b7-282066132de2", "55a99720-744b-0130-e1b7-282066132de2", "5bbda300-744b-0130-e1b7-282066132de2", "5bd45510-744b-0130-e1b7-282066132de2", "5beed450-744b-0130-e1b7-282066132de2", "5c074f90-744b-0130-e1b7-282066132de2", "567d9030-744b-0130-e1b7-282066132de2", "569011f0-744b-0130-e1b7-282066132de2", "56aaa640-744b-0130-e1b7-282066132de2", "56d5f8b0-744b-0130-e1b7-282066132de2", "5cd13b40-744b-0130-e1b7-282066132de2", "5ce374f0-744b-0130-e1b7-282066132de2", "57839ca0-744b-0130-e1b7-282066132de2", "579a1eb0-744b-0130-e1b7-282066132de2", "57ca2fb0-744b-0130-e1b7-282066132de2", "57f16070-744b-0130-e1b7-282066132de2", "5d8b23b0-744b-0130-e1b7-282066132de2", "5da0f380-744b-0130-e1b7-282066132de2", "58a4b100-744b-0130-e1b7-282066132de2", "58b9da70-744b-0130-e1b7-282066132de2", "58d8bec0-744b-0130-e1b7-282066132de2", "58ee6f80-744b-0130-e1b7-282066132de2", "590486e0-744b-0130-e1b7-282066132de2", "591aaa70-744b-0130-e1b7-282066132de2", "5946b660-744b-0130-e1b7-282066132de2", "596c4f70-744b-0130-e1b7-282066132de2", "5e536bd0-744b-0130-e1b7-282066132de2", "5e692850-744b-0130-e1b7-282066132de2", "5e8637a0-744b-0130-e1b7-282066132de2", "5e9d8430-744b-0130-e1b7-282066132de2", "5a2f7f20-744b-0130-e1b7-282066132de2", "5a4057d0-744b-0130-e1b7-282066132de2", "5a5b1150-744b-0130-e1b7-282066132de2", "5a87cd70-744b-0130-e1b7-282066132de2", "5f485f50-744b-0130-e1b7-282066132de2", "5f5e13c0-744b-0130-e1b7-282066132de2", "60289b60-744b-0130-e1b7-282066132de2", "603d04a0-744b-0130-e1b7-282066132de2", "60797200-744b-0130-e1b7-282066132de2", "609ec760-744b-0130-e1b7-282066132de2", "6160a2f0-744b-0130-e1b7-282066132de2", "61b8d190-744b-0130-e1b7-282066132de2", "61c4f540-744b-0130-e1b7-282066132de2", "626e8060-744b-0130-e1b7-282066132de2", "62eb7e20-744b-0130-e1b7-282066132de2", "62fd0410-744b-0130-e1b7-282066132de2", "6315de80-744b-0130-e1b7-282066132de2", "633f88e0-744b-0130-e1b7-282066132de2", "640f3c00-744b-0130-e1b7-282066132de2", "64967880-744b-0130-e1b7-282066132de2", "64a358d0-744b-0130-e1b7-282066132de2", "6548bbe0-744b-0130-e1b7-282066132de2"])

    header('Accept', 'application/json')
    header('Content-Type', 'application/json')



  # Get the root JSON


    response = get "/" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"actions\":{\"create\":\"http://example.org/actions/action\"}},\"batches\":{\"actions\":{\"create\":\"http://example.org/batches\",\"read\":\"http://example.org/batches\",\"first\":\"http://example.org/batches/page=1\",\"last\":\"http://example.org/batches/page=-1\"}},\"users\":{\"actions\":{\"create\":\"http://example.org/users\",\"read\":\"http://example.org/users\",\"first\":\"http://example.org/users/page=1\",\"last\":\"http://example.org/users/page=-1\"}},\"studies\":{\"actions\":{\"create\":\"http://example.org/studies\",\"read\":\"http://example.org/studies\",\"first\":\"http://example.org/studies/page=1\",\"last\":\"http://example.org/studies/page=-1\"}},\"orders\":{\"actions\":{\"create\":\"http://example.org/orders\",\"read\":\"http://example.org/orders\",\"first\":\"http://example.org/orders/page=1\",\"last\":\"http://example.org/orders/page=-1\"}},\"projects\":{\"actions\":{\"create\":\"http://example.org/projects\",\"read\":\"http://example.org/projects\",\"first\":\"http://example.org/projects/page=1\",\"last\":\"http://example.org/projects/page=-1\"}},\"samples\":{\"actions\":{\"create\":\"http://example.org/samples\",\"read\":\"http://example.org/samples\",\"first\":\"http://example.org/samples/page=1\",\"last\":\"http://example.org/samples/page=-1\"}},\"oligos\":{\"actions\":{\"create\":\"http://example.org/oligos\",\"read\":\"http://example.org/oligos\",\"first\":\"http://example.org/oligos/page=1\",\"last\":\"http://example.org/oligos/page=-1\"}},\"aliquots\":{\"actions\":{\"create\":\"http://example.org/aliquots\",\"read\":\"http://example.org/aliquots\",\"first\":\"http://example.org/aliquots/page=1\",\"last\":\"http://example.org/aliquots/page=-1\"}},\"flowcells\":{\"actions\":{\"create\":\"http://example.org/flowcells\",\"read\":\"http://example.org/flowcells\",\"first\":\"http://example.org/flowcells/page=1\",\"last\":\"http://example.org/flowcells/page=-1\"}},\"gels\":{\"actions\":{\"create\":\"http://example.org/gels\",\"read\":\"http://example.org/gels\",\"first\":\"http://example.org/gels/page=1\",\"last\":\"http://example.org/gels/page=-1\"}},\"labellables\":{\"actions\":{\"create\":\"http://example.org/labellables\",\"read\":\"http://example.org/labellables\",\"first\":\"http://example.org/labellables/page=1\",\"last\":\"http://example.org/labellables/page=-1\"}},\"sanger_barcodes\":{\"actions\":{\"create\":\"http://example.org/sanger_barcodes\",\"read\":\"http://example.org/sanger_barcodes\",\"first\":\"http://example.org/sanger_barcodes/page=1\",\"last\":\"http://example.org/sanger_barcodes/page=-1\"}},\"ean13_barcodes\":{\"actions\":{\"create\":\"http://example.org/ean13_barcodes\",\"read\":\"http://example.org/ean13_barcodes\",\"first\":\"http://example.org/ean13_barcodes/page=1\",\"last\":\"http://example.org/ean13_barcodes/page=-1\"}},\"barcode2_ds\":{\"actions\":{\"create\":\"http://example.org/barcode2_ds\",\"read\":\"http://example.org/barcode2_ds\",\"first\":\"http://example.org/barcode2_ds/page=1\",\"last\":\"http://example.org/barcode2_ds/page=-1\"}},\"plates\":{\"actions\":{\"create\":\"http://example.org/plates\",\"read\":\"http://example.org/plates\",\"first\":\"http://example.org/plates/page=1\",\"last\":\"http://example.org/plates/page=-1\"}},\"spin_columns\":{\"actions\":{\"create\":\"http://example.org/spin_columns\",\"read\":\"http://example.org/spin_columns\",\"first\":\"http://example.org/spin_columns/page=1\",\"last\":\"http://example.org/spin_columns/page=-1\"}},\"tubes\":{\"actions\":{\"create\":\"http://example.org/tubes\",\"read\":\"http://example.org/tubes\",\"first\":\"http://example.org/tubes/page=1\",\"last\":\"http://example.org/tubes/page=-1\"}},\"tube_racks\":{\"actions\":{\"create\":\"http://example.org/tube_racks\",\"read\":\"http://example.org/tube_racks\",\"first\":\"http://example.org/tube_racks/page=1\",\"last\":\"http://example.org/tube_racks/page=-1\"}},\"tag_groups\":{\"actions\":{\"create\":\"http://example.org/tag_groups\",\"read\":\"http://example.org/tag_groups\",\"first\":\"http://example.org/tag_groups/page=1\",\"last\":\"http://example.org/tag_groups/page=-1\"}},\"searches\":{\"actions\":{\"create\":\"http://example.org/searches\",\"read\":\"http://example.org/searches\",\"first\":\"http://example.org/searches/page=1\",\"last\":\"http://example.org/searches/page=-1\"}},\"multi_criteria_filters\":{\"actions\":{\"create\":\"http://example.org/multi_criteria_filters\",\"read\":\"http://example.org/multi_criteria_filters\",\"first\":\"http://example.org/multi_criteria_filters/page=1\",\"last\":\"http://example.org/multi_criteria_filters/page=-1\"}},\"label_filters\":{\"actions\":{\"create\":\"http://example.org/label_filters\",\"read\":\"http://example.org/label_filters\",\"first\":\"http://example.org/label_filters/page=1\",\"last\":\"http://example.org/label_filters/page=-1\"}},\"order_filters\":{\"actions\":{\"create\":\"http://example.org/order_filters\",\"read\":\"http://example.org/order_filters\",\"first\":\"http://example.org/order_filters/page=1\",\"last\":\"http://example.org/order_filters/page=-1\"}},\"batch_filters\":{\"actions\":{\"create\":\"http://example.org/batch_filters\",\"read\":\"http://example.org/batch_filters\",\"first\":\"http://example.org/batch_filters/page=1\",\"last\":\"http://example.org/batch_filters/page=-1\"}},\"uuid_resources\":{\"actions\":{\"create\":\"http://example.org/uuid_resources\",\"read\":\"http://example.org/uuid_resources\",\"first\":\"http://example.org/uuid_resources/page=1\",\"last\":\"http://example.org/uuid_resources/page=-1\"}},\"create_batches\":{\"actions\":{\"create\":\"http://example.org/actions/create_batch\"}},\"create_flowcells\":{\"actions\":{\"create\":\"http://example.org/actions/create_flowcell\"}},\"create_gels\":{\"actions\":{\"create\":\"http://example.org/actions/create_gel\"}},\"create_labels\":{\"actions\":{\"create\":\"http://example.org/actions/create_label\"}},\"create_labellables\":{\"actions\":{\"create\":\"http://example.org/actions/create_labellable\"}},\"create_orders\":{\"actions\":{\"create\":\"http://example.org/actions/create_order\"}},\"create_plates\":{\"actions\":{\"create\":\"http://example.org/actions/create_plate\"}},\"create_searches\":{\"actions\":{\"create\":\"http://example.org/actions/create_search\"}},\"create_spin_columns\":{\"actions\":{\"create\":\"http://example.org/actions/create_spin_column\"}},\"create_tubes\":{\"actions\":{\"create\":\"http://example.org/actions/create_tube\"}},\"create_tube_racks\":{\"actions\":{\"create\":\"http://example.org/actions/create_tube_rack\"}},\"plate_transfers\":{\"actions\":{\"create\":\"http://example.org/actions/plate_transfer\"}},\"tag_wells\":{\"actions\":{\"create\":\"http://example.org/actions/tag_wells\"}},\"transfer_plates_to_plates\":{\"actions\":{\"create\":\"http://example.org/actions/transfer_plates_to_plates\"}},\"transfer_tubes_to_tubes\":{\"actions\":{\"create\":\"http://example.org/actions/transfer_tubes_to_tubes\"}},\"transfer_wells_to_tubes\":{\"actions\":{\"create\":\"http://example.org/actions/transfer_wells_to_tubes\"}},\"tube_rack_moves\":{\"actions\":{\"create\":\"http://example.org/actions/tube_rack_move\"}},\"tube_rack_transfers\":{\"actions\":{\"create\":\"http://example.org/actions/tube_rack_transfer\"}},\"update_orders\":{\"actions\":{\"create\":\"http://example.org/actions/update_order\"}},\"update_plates\":{\"actions\":{\"create\":\"http://example.org/actions/update_plate\"}},\"update_tubes\":{\"actions\":{\"create\":\"http://example.org/actions/update_tube\"}},\"update_tube_racks\":{\"actions\":{\"create\":\"http://example.org/actions/update_tube_rack\"}},\"revision\":3}"



  # Find tube by barcode for 1220017279667


    response = post "/searches", "{\"search\":{\"description\":\"search for barcoded tube\",\"model\":\"tube\",\"criteria\":{\"label\":{\"position\":\"barcode\",\"type\":\"ean13-barcode\",\"value\":\"1220017279667\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/5369ced0-744b-0130-e1b7-282066132de2\",\"first\":\"http://example.org/5369ced0-744b-0130-e1b7-282066132de2/page=1\",\"last\":\"http://example.org/5369ced0-744b-0130-e1b7-282066132de2/page=-1\"},\"uuid\":\"5369ced0-744b-0130-e1b7-282066132de2\"}}"

  # Get the search result (tube)


    response = get "/5369ced0-744b-0130-e1b7-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/tubes/page=1\",\"first\":\"http://example.org/tubes/page=1\",\"last\":\"http://example.org/tubes/page=-1\"},\"size\":1,\"tubes\":[{\"actions\":{\"read\":\"http://example.org/ebe04b50-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe04b50-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe04b50-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe04b50-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/ebe06630-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe06630-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe06630-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe06630-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe06630-744a-0130-e1da-282066132de2\",\"barcode\":{\"value\":\"1220017279667\",\"type\":\"ean13-barcode\"}}}]}"

  # Find tube by barcode for 1220017279668


    response = post "/searches", "{\"search\":{\"description\":\"search for barcoded tube\",\"model\":\"tube\",\"criteria\":{\"label\":{\"position\":\"barcode\",\"type\":\"ean13-barcode\",\"value\":\"1220017279668\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/5370a9c0-744b-0130-e1b7-282066132de2\",\"first\":\"http://example.org/5370a9c0-744b-0130-e1b7-282066132de2/page=1\",\"last\":\"http://example.org/5370a9c0-744b-0130-e1b7-282066132de2/page=-1\"},\"uuid\":\"5370a9c0-744b-0130-e1b7-282066132de2\"}}"

  # Get the search result (tube)


    response = get "/5370a9c0-744b-0130-e1b7-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/tubes/page=1\",\"first\":\"http://example.org/tubes/page=1\",\"last\":\"http://example.org/tubes/page=-1\"},\"size\":1,\"tubes\":[{\"actions\":{\"read\":\"http://example.org/ebe2d310-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe2d310-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe2d310-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe2d310-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/ebe2e9f0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe2e9f0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe2e9f0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe2e9f0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe2e9f0-744a-0130-e1da-282066132de2\",\"barcode\":{\"value\":\"1220017279668\",\"type\":\"ean13-barcode\"}}}]}"

  # Find the order by tube uuid and role


    response = post "/searches", "{\"search\":{\"description\":\"search for order\",\"model\":\"order\",\"criteria\":{\"item\":{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"role\":\"tube_to_be_extracted_na+p\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/537663e0-744b-0130-e1b7-282066132de2\",\"first\":\"http://example.org/537663e0-744b-0130-e1b7-282066132de2/page=1\",\"last\":\"http://example.org/537663e0-744b-0130-e1b7-282066132de2/page=-1\"},\"uuid\":\"537663e0-744b-0130-e1b7-282066132de2\"}}"

  # Get the search results (order)


    response = get "/537663e0-744b-0130-e1b7-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/orders/page=1\",\"first\":\"http://example.org/orders/page=1\",\"last\":\"http://example.org/orders/page=-1\"},\"size\":1,\"orders\":[{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":null},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":null}]}}]}"

  # Create a new batch


    response = post "/batches", "{\"batch\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}"

  # Assign the batch uuid to the tubes in the order items


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"tube_to_be_extracted_na+p\":{\"ebe04b50-744a-0130-e1da-282066132de2\":{\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"ebe2d310-744a-0130-e1da-282066132de2\":{\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Add the tube_to_be_extracted_nap under the role binding_tube_to_be_extracted_nap and start them.


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_tube_to_be_extracted_na+p\":{\"ebe04b50-744a-0130-e1da-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"ebe2d310-744a-0130-e1da-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Change the status of binding_tube_to_be_extracted_nap to done. Change the status of tube_to_be_extracted_nap to unused.


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_tube_to_be_extracted_na+p\":{\"ebe04b50-744a-0130-e1da-282066132de2\":{\"event\":\"complete\"},\"ebe2d310-744a-0130-e1da-282066132de2\":{\"event\":\"complete\"}},\"tube_to_be_extracted_na+p\":{\"ebe04b50-744a-0130-e1da-282066132de2\":{\"event\":\"unuse\"},\"ebe2d310-744a-0130-e1da-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Find tube by barcode for 1220017279669


    response = post "/searches", "{\"search\":{\"description\":\"search for barcoded tube\",\"model\":\"tube\",\"criteria\":{\"label\":{\"position\":\"barcode\",\"type\":\"ean13-barcode\",\"value\":\"1220017279669\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/53ef5d80-744b-0130-e1b7-282066132de2\",\"first\":\"http://example.org/53ef5d80-744b-0130-e1b7-282066132de2/page=1\",\"last\":\"http://example.org/53ef5d80-744b-0130-e1b7-282066132de2/page=-1\"},\"uuid\":\"53ef5d80-744b-0130-e1b7-282066132de2\"}}"

  # Get the search result (tube)


    response = get "/53ef5d80-744b-0130-e1b7-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/tubes/page=1\",\"first\":\"http://example.org/tubes/page=1\",\"last\":\"http://example.org/tubes/page=-1\"},\"size\":1,\"tubes\":[{\"actions\":{\"read\":\"http://example.org/ebe55ab0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe55ab0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe55ab0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe55ab0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/ebe57030-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe57030-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe57030-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe57030-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe57030-744a-0130-e1da-282066132de2\",\"barcode\":{\"value\":\"1220017279669\",\"type\":\"ean13-barcode\"}}}]}"

  # Find the order by tube uuid and role


    response = post "/searches", "{\"search\":{\"description\":\"search for order\",\"model\":\"order\",\"criteria\":{\"item\":{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"role\":\"tube_to_be_extracted_na+p\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/541de560-744b-0130-e1b7-282066132de2\",\"first\":\"http://example.org/541de560-744b-0130-e1b7-282066132de2/page=1\",\"last\":\"http://example.org/541de560-744b-0130-e1b7-282066132de2/page=-1\"},\"uuid\":\"541de560-744b-0130-e1b7-282066132de2\"}}"

  # Get the search results (order)


    response = get "/541de560-744b-0130-e1b7-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/orders/page=1\",\"first\":\"http://example.org/orders/page=1\",\"last\":\"http://example.org/orders/page=-1\"},\"size\":1,\"orders\":[{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":null}]}}]}"

  # Assign the batch uuid to the tubes in the order items


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"tube_to_be_extracted_na+p\":{\"ebe55ab0-744a-0130-e1da-282066132de2\":{\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Add the tube_to_be_extracted_nap under the role binding_tube_to_be_extracted_nap and start them.


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_tube_to_be_extracted_na+p\":{\"ebe55ab0-744a-0130-e1da-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Change the status of binding_tube_to_be_extracted_nap to done. Change the status of tube_to_be_extracted_nap to unused.


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_tube_to_be_extracted_na+p\":{\"ebe55ab0-744a-0130-e1da-282066132de2\":{\"event\":\"complete\"}},\"tube_to_be_extracted_na+p\":{\"ebe55ab0-744a-0130-e1da-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create the search order by batch


    response = post "/searches", "{\"search\":{\"description\":\"search order by batch\",\"model\":\"order\",\"criteria\":{\"item\":{\"batch\":\"537c3440-744b-0130-e1b7-282066132de2\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/549064e0-744b-0130-e1b7-282066132de2\",\"first\":\"http://example.org/549064e0-744b-0130-e1b7-282066132de2/page=1\",\"last\":\"http://example.org/549064e0-744b-0130-e1b7-282066132de2/page=-1\"},\"uuid\":\"549064e0-744b-0130-e1b7-282066132de2\"}}"

  # Get the result orders


    response = get "/549064e0-744b-0130-e1b7-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/orders/page=1\",\"first\":\"http://example.org/orders/page=1\",\"last\":\"http://example.org/orders/page=-1\"},\"size\":2,\"orders\":[{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}},{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}]}"



  # Change the status of the order to pending


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"event\":\"build\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"pending\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Change the status of the order to in_progress


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"event\":\"start\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Change the status of the order to pending


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"event\":\"build\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"pending\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Change the status of the order to in_progress


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"event\":\"start\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new spin columns


    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\"},\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"54f98010-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\"},\"uuid\":\"550d9e20-744b-0130-e1b7-282066132de2\",\"name\":\"54f98010-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\"},\"uuid\":\"553cd700-744b-0130-e1b7-282066132de2\",\"name\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}}}}"

  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567893000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5568eb70-744b-0130-e1b7-282066132de2\",\"name\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567893000\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5584a020-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567894000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\"},\"uuid\":\"55a99720-744b-0130-e1b7-282066132de2\",\"name\":\"5584a020-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567894000\",\"type\":\"ean13-barcode\"}}}}"

  # Add the new spin columns and new tubes in the order and start each of them


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_spin_column_dna\":{\"54f98010-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"5527ead0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}},\"by_product_tube_rna+p\":{\"55543cd0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"5584a020-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfers from tube_to_be_extracted into binding_spin_column_dna spins and into by_product_tube tubes.


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"target_uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"target_uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"target_uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"},{\"source_uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"target_uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/ebe04b50-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe04b50-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe04b50-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe04b50-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/ebe06630-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe06630-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe06630-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe06630-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe06630-744a-0130-e1da-282066132de2\",\"barcode\":{\"value\":\"1220017279667\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/ebe2d310-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe2d310-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe2d310-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe2d310-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/ebe2e9f0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe2e9f0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe2e9f0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe2e9f0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe2e9f0-744a-0130-e1da-282066132de2\",\"barcode\":{\"value\":\"1220017279668\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\"},\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\"},\"uuid\":\"550d9e20-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}},{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\"},\"uuid\":\"553cd700-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5568eb70-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567893000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\"},\"uuid\":\"55a99720-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567894000\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"target_uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"target_uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"target_uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"},{\"source_uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"target_uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"}]}}"

  # Change the status of the binding_spin_column_dna to done. Change the status of the by_product_tube to done. Change the status of the tube_to_be_extracted to unused


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_spin_column_dna\":{\"54f98010-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"},\"5527ead0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"55543cd0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"},\"5584a020-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"binding_tube_to_be_extracted_na+p\":{\"ebe04b50-744a-0130-e1da-282066132de2\":{\"event\":\"unuse\"},\"ebe2d310-744a-0130-e1da-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new spin columns


    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891500\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5bd45510-744b-0130-e1b7-282066132de2\",\"name\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891500\",\"type\":\"ean13-barcode\"}}}}"

  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5beed450-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891600\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5c074f90-744b-0130-e1b7-282066132de2\",\"name\":\"5beed450-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891600\",\"type\":\"ean13-barcode\"}}}}"

  # Add the new spin columns and new tubes in the order and start each of them


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_spin_column_dna\":{\"5bbda300-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}},\"by_product_tube_rna+p\":{\"5beed450-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfers from tube_to_be_extracted into binding_spin_column_dna spins and into by_product_tube tubes.


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"target_uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"target_uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/ebe55ab0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe55ab0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe55ab0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe55ab0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/ebe57030-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe57030-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe57030-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe57030-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe57030-744a-0130-e1da-282066132de2\",\"barcode\":{\"value\":\"1220017279669\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5bd45510-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891500\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5c074f90-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891600\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"target_uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"target_uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"}]}}"

  # Change the status of the binding_spin_column_dna to done. Change the status of the by_product_tube to done. Change the status of the tube_to_be_extracted to unused


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_spin_column_dna\":{\"5bbda300-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"5beed450-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"binding_tube_to_be_extracted_na+p\":{\"ebe55ab0-744a-0130-e1da-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\"},\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"567d9030-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567895000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"569011f0-744b-0130-e1b7-282066132de2\",\"name\":\"567d9030-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567895000\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\"},\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567896000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"56d5f8b0-744b-0130-e1b7-282066132de2\",\"name\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567896000\",\"type\":\"ean13-barcode\"}}}}"

  # Add the extracted_dna_tube in the order and start them


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"567d9030-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"56aaa640-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfer binding_spin_column_dna into extracted_tube


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/54f98010-744b-0130-e1b7-282066132de2\"},\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/550d9e20-744b-0130-e1b7-282066132de2\"},\"uuid\":\"550d9e20-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}},{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5527ead0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/553cd700-744b-0130-e1b7-282066132de2\"},\"uuid\":\"553cd700-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\"},\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"569011f0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567895000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\"},\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"56d5f8b0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567896000\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to done. Change the status of binding_spin_column_dna to unused


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"567d9030-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"},\"56aaa640-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"binding_spin_column_dna\":{\"54f98010-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"},\"5527ead0-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891700\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5ce374f0-744b-0130-e1b7-282066132de2\",\"name\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891700\",\"type\":\"ean13-barcode\"}}}}"

  # Add the extracted_dna_tube in the order and start them


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"5cd13b40-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfer binding_spin_column_dna into extracted_tube


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5bbda300-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5bd45510-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5bd45510-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891500\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5ce374f0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891700\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to done. Change the status of binding_spin_column_dna to unused


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"5cd13b40-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"binding_spin_column_dna\":{\"5bbda300-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567897000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"579a1eb0-744b-0130-e1b7-282066132de2\",\"name\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567897000\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567898000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\"},\"uuid\":\"57f16070-744b-0130-e1b7-282066132de2\",\"name\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567898000\",\"type\":\"ean13-barcode\"}}}}"

  # Add tube_to_be_extracted tubes in the order and start them.


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"tube_to_be_extracted_rna+p\":{\"57839ca0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"57ca2fb0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfer from by_product_tube tubes into tube_to_be_extracted tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/55543cd0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5568eb70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5568eb70-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567893000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5584a020-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/55a99720-744b-0130-e1b7-282066132de2\"},\"uuid\":\"55a99720-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567894000\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"579a1eb0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567897000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\"},\"uuid\":\"57f16070-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567898000\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of by_product_tube to done. Change the status of tube_to_be_extracted to done


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"tube_to_be_extracted_rna+p\":{\"57839ca0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"},\"57ca2fb0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"55543cd0-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"},\"5584a020-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891800\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5da0f380-744b-0130-e1b7-282066132de2\",\"name\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891800\",\"type\":\"ean13-barcode\"}}}}"

  # Add tube_to_be_extracted tubes in the order and start them.


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"tube_to_be_extracted_rna+p\":{\"5d8b23b0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfer from by_product_tube tubes into tube_to_be_extracted tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5beed450-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5c074f90-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5c074f90-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891600\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5da0f380-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891800\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of by_product_tube to done. Change the status of tube_to_be_extracted to done


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"tube_to_be_extracted_rna+p\":{\"5d8b23b0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"5beed450-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new spin columns


    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567899000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58b9da70-744b-0130-e1b7-282066132de2\",\"name\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567899000\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58ee6f80-744b-0130-e1b7-282066132de2\",\"name\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}}"

  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/590486e0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/590486e0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/590486e0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/590486e0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"590486e0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891100\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/591aaa70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/591aaa70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/591aaa70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/591aaa70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"591aaa70-744b-0130-e1b7-282066132de2\",\"name\":\"590486e0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891100\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/5946b660-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5946b660-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5946b660-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5946b660-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5946b660-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891200\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/596c4f70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/596c4f70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/596c4f70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/596c4f70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"596c4f70-744b-0130-e1b7-282066132de2\",\"name\":\"5946b660-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891200\",\"type\":\"ean13-barcode\"}}}}"

  # Add the new spin columns and new tubes in the order and start each of them


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_spin_column_rna\":{\"58a4b100-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"58d8bec0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}},\"by_product_tube_rna+p\":{\"590486e0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"5946b660-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfers from tube_to_be_extracted into binding_spin_column_rna spins and into by_product_tube tubes.


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null},{\"source_uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/57839ca0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/579a1eb0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"579a1eb0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567897000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/57ca2fb0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/57f16070-744b-0130-e1b7-282066132de2\"},\"uuid\":\"57f16070-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567898000\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58b9da70-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567899000\",\"type\":\"ean13-barcode\"}}}},{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58ee6f80-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/590486e0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/590486e0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/590486e0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/590486e0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/591aaa70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/591aaa70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/591aaa70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/591aaa70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"591aaa70-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891100\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/5946b660-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5946b660-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5946b660-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5946b660-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/596c4f70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/596c4f70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/596c4f70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/596c4f70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"596c4f70-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891200\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null},{\"source_uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null}]}}"

  # Change the status of binding_spin_column_rna to done. Change the status of by_product_tube to done. Change the status of tube_to_be_extracted to unused


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_spin_column_rna\":{\"58a4b100-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"},\"58d8bec0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"590486e0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"},\"5946b660-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"tube_to_be_extracted_rna+p\":{\"57839ca0-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"},\"57ca2fb0-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new spin columns


    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891900\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5e692850-744b-0130-e1b7-282066132de2\",\"name\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891900\",\"type\":\"ean13-barcode\"}}}}"

  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/5e8637a0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5e8637a0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5e8637a0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5e8637a0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/5e9d8430-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5e9d8430-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5e9d8430-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5e9d8430-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5e9d8430-744b-0130-e1b7-282066132de2\",\"name\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}}}}"

  # Add the new spin columns and new tubes in the order and start each of them


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_spin_column_rna\":{\"5e536bd0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}},\"by_product_tube_rna+p\":{\"5e8637a0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfers from tube_to_be_extracted into binding_spin_column_rna spins and into by_product_tube tubes.


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5d8b23b0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5da0f380-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5da0f380-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891800\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5e692850-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891900\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/5e8637a0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5e8637a0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5e8637a0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5e8637a0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5e9d8430-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5e9d8430-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5e9d8430-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5e9d8430-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5e9d8430-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null}]}}"

  # Change the status of binding_spin_column_rna to done. Change the status of by_product_tube to done. Change the status of tube_to_be_extracted to unused


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"binding_spin_column_rna\":{\"5e536bd0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"5e8637a0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"tube_to_be_extracted_rna+p\":{\"5d8b23b0-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891300\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a4057d0-744b-0130-e1b7-282066132de2\",\"name\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891300\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891400\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a87cd70-744b-0130-e1b7-282066132de2\",\"name\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891400\",\"type\":\"ean13-barcode\"}}}}"

  # Add the extracted_rna_tube in the order and start them


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"5a2f7f20-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"5a5b1150-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfer binding_spin_column_rna into extracted_tube


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58a4b100-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58b9da70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58b9da70-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567899000\",\"type\":\"ean13-barcode\"}}}},{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58d8bec0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/58ee6f80-744b-0130-e1b7-282066132de2\"},\"uuid\":\"58ee6f80-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a4057d0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891300\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a87cd70-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891400\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to done. Change the status of binding_spin_column_rna to unused


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"5a2f7f20-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"},\"5a5b1150-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"binding_spin_column_rna\":{\"58a4b100-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"},\"58d8bec0-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892100\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5f5e13c0-744b-0130-e1b7-282066132de2\",\"name\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892100\",\"type\":\"ean13-barcode\"}}}}"

  # Add the extracted_rna_tube in the order and start them


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"5f485f50-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfer binding_spin_column_rna into extracted_tube


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5e536bd0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5e692850-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5e692850-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891900\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5f5e13c0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892100\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to done. Change the status of binding_spin_column_rna to unused


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"5f485f50-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}},\"binding_spin_column_rna\":{\"5e536bd0-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\"},\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"60289b60-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892200\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"603d04a0-744b-0130-e1b7-282066132de2\",\"name\":\"60289b60-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892200\",\"type\":\"2d-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\"},\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"60797200-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892300\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\"},\"uuid\":\"609ec760-744b-0130-e1b7-282066132de2\",\"name\":\"60797200-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892300\",\"type\":\"2d-barcode\"}}}}"

  # Add the 2d tubes in the order and start them


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"name\":{\"60289b60-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"60797200-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfer extracted tubes into 2D tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a2f7f20-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a4057d0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a4057d0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891300\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a5b1150-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5a87cd70-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5a87cd70-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891400\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\"},\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"603d04a0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892200\",\"type\":\"2d-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\"},\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\"},\"uuid\":\"609ec760-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892300\",\"type\":\"2d-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to unused. Change the status of 2d tubes to complete


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"5a2f7f20-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"},\"5a5b1150-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}},\"name\":{\"60289b60-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"},\"60797200-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Create a new tube rack 


    response = post "/tube_racks", "{\"tube_rack\":{\"number_of_columns\":12,\"number_of_rows\":8,\"tubes\":{\"A1\":\"60289b60-744b-0130-e1b7-282066132de2\",\"A2\":\"60797200-744b-0130-e1b7-282066132de2\"},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube_rack\":{\"actions\":{\"read\":\"http://example.org/6160a2f0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/6160a2f0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/6160a2f0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/6160a2f0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"6160a2f0-744b-0130-e1b7-282066132de2\",\"number_of_rows\":8,\"number_of_columns\":12,\"tubes\":{\"A1\":{\"actions\":{\"read\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/60289b60-744b-0130-e1b7-282066132de2\"},\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/603d04a0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"603d04a0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892200\",\"type\":\"2d-barcode\"}}},\"A2\":{\"actions\":{\"read\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/60797200-744b-0130-e1b7-282066132de2\"},\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/609ec760-744b-0130-e1b7-282066132de2\"},\"uuid\":\"609ec760-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892300\",\"type\":\"2d-barcode\"}}}}}}"

  # Add the tube rack in the order and start it


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"Stock RNA\":{\"6160a2f0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"6160a2f0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Change the type of the rube rack to complete


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"Stock RNA\":{\"6160a2f0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"6160a2f0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\"},\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892400\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\"},\"uuid\":\"61c4f540-744b-0130-e1b7-282066132de2\",\"name\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892400\",\"type\":\"2d-barcode\"}}}}"

  # Add the 2d tubes in the order and start them


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"name\":{\"61b8d190-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfer extracted tubes into 2D tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5f485f50-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5f5e13c0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5f5e13c0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892100\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\"},\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\"},\"uuid\":\"61c4f540-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892400\",\"type\":\"2d-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to unused. Change the status of 2d tubes to complete


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"5f485f50-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}},\"name\":{\"61b8d190-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Create a new tube rack 


    response = post "/tube_racks", "{\"tube_rack\":{\"number_of_columns\":12,\"number_of_rows\":8,\"tubes\":{\"A1\":\"61b8d190-744b-0130-e1b7-282066132de2\"},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube_rack\":{\"actions\":{\"read\":\"http://example.org/626e8060-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/626e8060-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/626e8060-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/626e8060-744b-0130-e1b7-282066132de2\"},\"uuid\":\"626e8060-744b-0130-e1b7-282066132de2\",\"number_of_rows\":8,\"number_of_columns\":12,\"tubes\":{\"A1\":{\"actions\":{\"read\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/61b8d190-744b-0130-e1b7-282066132de2\"},\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/61c4f540-744b-0130-e1b7-282066132de2\"},\"uuid\":\"61c4f540-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892400\",\"type\":\"2d-barcode\"}}}}}}"

  # Add the tube rack in the order and start it


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"Stock RNA\":{\"626e8060-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"626e8060-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Change the type of the rube rack to complete


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"Stock RNA\":{\"626e8060-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"626e8060-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\"},\"uuid\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892500\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\"},\"uuid\":\"62fd0410-744b-0130-e1b7-282066132de2\",\"name\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892500\",\"type\":\"2d-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\"},\"uuid\":\"6315de80-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"6315de80-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892600\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"633f88e0-744b-0130-e1b7-282066132de2\",\"name\":\"6315de80-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892600\",\"type\":\"2d-barcode\"}}}}"

  # Add the 2d tubes in the order and start them


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"name\":{\"62eb7e20-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"},\"6315de80-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"6315de80-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"6160a2f0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfer extracted tubes into 2D tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"6315de80-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/567d9030-744b-0130-e1b7-282066132de2\"},\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/569011f0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"569011f0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567895000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/56aaa640-744b-0130-e1b7-282066132de2\"},\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/56d5f8b0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"56d5f8b0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567896000\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\"},\"uuid\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\"},\"uuid\":\"62fd0410-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892500\",\"type\":\"2d-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\"},\"uuid\":\"6315de80-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"633f88e0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892600\",\"type\":\"2d-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"6315de80-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to unused. Change the status of 2d tubes to complete


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"567d9030-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"},\"56aaa640-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}},\"name\":{\"62eb7e20-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"},\"6315de80-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"6315de80-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"6160a2f0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Create a new tube rack 


    response = post "/tube_racks", "{\"tube_rack\":{\"number_of_columns\":12,\"number_of_rows\":8,\"tubes\":{\"A1\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"A2\":\"6315de80-744b-0130-e1b7-282066132de2\"},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube_rack\":{\"actions\":{\"read\":\"http://example.org/640f3c00-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/640f3c00-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/640f3c00-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/640f3c00-744b-0130-e1b7-282066132de2\"},\"uuid\":\"640f3c00-744b-0130-e1b7-282066132de2\",\"number_of_rows\":8,\"number_of_columns\":12,\"tubes\":{\"A1\":{\"actions\":{\"read\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/62eb7e20-744b-0130-e1b7-282066132de2\"},\"uuid\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdb9490-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdb9490-744a-0130-e1da-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/62fd0410-744b-0130-e1b7-282066132de2\"},\"uuid\":\"62fd0410-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892500\",\"type\":\"2d-barcode\"}}},\"A2\":{\"actions\":{\"read\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/6315de80-744b-0130-e1b7-282066132de2\"},\"uuid\":\"6315de80-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebddfb00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebddfb00-744a-0130-e1da-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/633f88e0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"633f88e0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892600\",\"type\":\"2d-barcode\"}}}}}}"

  # Add the tube rack in the order and start it


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"Stock DNA\":{\"640f3c00-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"6315de80-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"6160a2f0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"640f3c00-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Change the type of the rube rack to complete


    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"items\":{\"Stock DNA\":{\"640f3c00-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"6315de80-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"6160a2f0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"640f3c00-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\"},\"uuid\":\"64967880-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"64967880-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892700\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"64a358d0-744b-0130-e1b7-282066132de2\",\"name\":\"64967880-744b-0130-e1b7-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892700\",\"type\":\"2d-barcode\"}}}}"

  # Add the 2d tubes in the order and start them


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"name\":{\"64967880-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"64967880-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"626e8060-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Transfer extracted tubes into 2D tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"64967880-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5cd13b40-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/5ce374f0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"5ce374f0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567891700\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\"},\"uuid\":\"64967880-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"64a358d0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892700\",\"type\":\"2d-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"target_uuid\":\"64967880-744b-0130-e1b7-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to unused. Change the status of 2d tubes to complete


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"5cd13b40-744b-0130-e1b7-282066132de2\":{\"event\":\"unuse\"}},\"name\":{\"64967880-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"64967880-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"626e8060-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Create a new tube rack 


    response = post "/tube_racks", "{\"tube_rack\":{\"number_of_columns\":12,\"number_of_rows\":8,\"tubes\":{\"A1\":\"64967880-744b-0130-e1b7-282066132de2\"},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube_rack\":{\"actions\":{\"read\":\"http://example.org/6548bbe0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/6548bbe0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/6548bbe0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/6548bbe0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"6548bbe0-744b-0130-e1b7-282066132de2\",\"number_of_rows\":8,\"number_of_columns\":12,\"tubes\":{\"A1\":{\"actions\":{\"read\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/64967880-744b-0130-e1b7-282066132de2\"},\"uuid\":\"64967880-744b-0130-e1b7-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebdf14a0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebdf14a0-744a-0130-e1da-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/64a358d0-744b-0130-e1b7-282066132de2\"},\"uuid\":\"64a358d0-744b-0130-e1b7-282066132de2\",\"barcode\":{\"value\":\"1234567892700\",\"type\":\"2d-barcode\"}}}}}}"

  # Add the tube rack in the order and start it


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"Stock DNA\":{\"6548bbe0-744b-0130-e1b7-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"537c3440-744b-0130-e1b7-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"64967880-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"626e8060-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"6548bbe0-744b-0130-e1b7-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  # Change the type of the rube rack to complete


    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"items\":{\"Stock DNA\":{\"6548bbe0-744b-0130-e1b7-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"64967880-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"626e8060-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"6548bbe0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"





    response = put "/ebe7bf00-744a-0130-e1da-282066132de2", "{\"event\":\"complete\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe7bf00-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe7bf00-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"completed\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe04b50-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"ebe2d310-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"54f98010-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5527ead0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"55543cd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5584a020-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"590486e0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5946b660-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"567d9030-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"56aaa640-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"57839ca0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"57ca2fb0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"58a4b100-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"58d8bec0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5a2f7f20-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5a5b1150-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"60289b60-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"60797200-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"62eb7e20-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"6315de80-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"6160a2f0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"640f3c00-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"





    response = put "/ebe95980-744a-0130-e1da-282066132de2", "{\"event\":\"complete\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebe95980-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebe95980-744a-0130-e1da-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"completed\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda2af0-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda2af0-744a-0130-e1da-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"create\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"update\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\",\"delete\":\"http://example.org/ebda4580-744a-0130-e1da-282066132de2\"},\"uuid\":\"ebda4580-744a-0130-e1da-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"ebe55ab0-744a-0130-e1da-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"5bbda300-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"5beed450-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"5e8637a0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"5cd13b40-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"5d8b23b0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"5e536bd0-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"5f485f50-744b-0130-e1b7-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"61b8d190-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}},{\"uuid\":\"64967880-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"626e8060-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"6548bbe0-744b-0130-e1b7-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"create\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"update\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\",\"delete\":\"http://example.org/537c3440-744b-0130-e1b7-282066132de2\"},\"uuid\":\"537c3440-744b-0130-e1b7-282066132de2\",\"process\":null}}]}}}"

  end
end
